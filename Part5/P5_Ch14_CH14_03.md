# Deep Metric Learning - 3. Contrastive Learningì˜ ë°œë‹¬ (SIMCLR, Supervised Methods)
## Contrastive Learning
ë¶„ë¥˜(classification), ìƒì„±(generation), êµ°ì§‘í™”(clustering) ë“± taskë¥¼ í•  ë•Œ,  
outer space ì—ì„œ model output ì„ ì§ì ‘ ì´ìš©í•˜ì§€ ì•Šê³ , representation space ì—ì„œ contrastive objectiveì„ ì‚¬ìš©í•˜ì—¬ ì†ì‹¤(loss)ì„ ê³„ì‚°í•˜ëŠ” ê²ƒì„ "Contrastive Learning"ì´ë¼ í•œë‹¤!   
ì´ë•Œ, contrastive objectiveëŠ” ê¼­ contrastive lossê°€ ì•„ë‹ˆì–´ë„ ëœë‹¤!  
  
ì˜ˆë¥¼ ë“¤ì–´, contrastive learningì´ triplet lossì—¬ë„ ìƒê´€ì´ ì—†ë‹¤  
- ë³´í†µ, contrastive learningì—ì„œì˜ contrastive objectiveëŠ” input ê°„ì˜ similarity/dissimilarity representationì„ í•™ìŠµí•˜ê¸¸ ê¸°ëŒ€í•œë‹¤.

<img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 00 30" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/aa041f62-f6cb-452c-90b3-1f92e62974a4">

## Recap: Self-supervised learning (ìê¸° ì§€ë„ í•™ìŠµ)
- ìê¸° ì§€ë„ í•™ìŠµ(Self-supervised learning)
  - ë‹¤ëŸ‰ì˜ ë ˆì´ë¸”ì´ ì—†ëŠ” ì›ë°ì´í„°ë¡œë¶€í„° ë°ì´í„° ë¶€ë¶„ë“¤ì˜ ê´€ê³„ë¥¼ í†µí•´ ë ˆì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ì§€ë„í•™ìŠµì— ì´ìš©
  - Pretext taskë¥¼ ì„¤ì •(i.e. ë°ì´í„°ì˜ ì¼ë¶€ë¶„ì„ ì€ë‹‰í•˜ì—¬ ëª¨ë¸ì´ ê·¸ ë¶€ë¶„ì„ ì˜ˆì¸¡í•˜ë„ë¡ í•™ìŠµ)í•˜ì—¬ ì´ë¥¼ í•™ìŠµí•œ í›„, downstream taskë¡œ ì „ì´ í•™ìŠµ (transfer learning) í•˜ì—¬ ë‹¤ë¥¸ taskì— ì ìš©.
- Pretext taskë¡œ contrastive task (data augmentation + similarity measure)ì„ ìˆ˜í–‰í•˜ë©´ ì–´ë–¨ê¹Œ?
- ì•„ë‹ˆë©´ ë°”ë¡œ lossì‹ì„ ì ìš©í•˜ì—¬ pretext taskì—†ì´ end-to-endë¡œ í•œë²ˆì— í•™ìŠµí•˜ë©´ ì–´ë–¨ê¹Œ?

  -> Contrastive self-supervised learning!

## Semi-supervised Contrastive Learning - SimCLR (2020)
4ê°€ì§€ ì£¼ìš” êµ¬ì„±ìš”ì†Œë¡œ 2020 self-supervised SOTA. 

<img width="400" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 18 16" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/12e8c9fb-5b03-4421-b722-a498d40cb731">

- Data augmentation
  - ê°™ì€ ì´ë¯¸ì§€ ìƒ˜í”Œì„ ë‹¤ë¥¸ ë‘ ê°€ì§€ ë²„ì „(positive pair)ë¡œ ë³€í˜•ì‹œí‚¤ëŠ” stochastic data augmentation moduleì´ ì¡´ì¬.
    - Random cropping, random color distortions, random Gaussian blur ì ìš©
      
- Encoder: f(Â·) -> DNN(ResNet)ê¸°ë°˜ encoder(f)ë¡œ representation vectorì„ ë½‘ëŠ”ë‹¤.
  
- Neural network projection head: g(Â·) -> representationë“¤ì„ contrastive lossê°€ ì ìš©ëœ spaceë¡œ ë§¤í•‘
  - 1 ì€ë‹‰ì¸µ MLP ì‚¬ìš©
    
- Contrastive prediction task
  - Positive pairì¸ $x_i$ ì™€ $x_j$ì„ í¬í•¨í•œ set { $ğ‘¥_k$ } ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, contrastive prediction taskëŠ” ì£¼ì–´ì§„ $x_i$ ì— ëŒ€í•´ { $ğ‘¥_k$ } ğ‘˜ â‰  ğ‘– ì—ì„œ $x_j$ ì„ ì‹ë³„í•˜ëŠ”ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤.

## ëª©ì  í•¨ìˆ˜ëŠ”?

- Nê°œ exampleì´ë¼ë©´, íŒŒìƒëœ augmented examplesì˜ ìŒì— ëŒ€í•´ ê°ê° Nê°œ ì”© ì´ 2N data pointsê°€ ìƒì„±.
- ë‚˜ë¨¸ì§€ 2(N-1)ì„ negative sampleë¡œ ì²˜ë¦¬ 
- Pairwise similarity( $s_{i,j}$ )ë¥¼ ëª¨ë“  ğ‘–, ğ‘— âˆˆ {1 ... , 2ğ‘}ì— ëŒ€í•´ ê³„ì‚° -> ë…¼ë¬¸ì—ì„œëŠ” cosine similarityë¡œ ê³„ì‚°. <img width="100" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 20 36" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/481fd8de-bea4-4687-a9f5-accbe44c6638">

- Loss function(ğ‘™(ğ‘–, ğ‘—)): NT-Xent (normalized temperature-scaled cross entropy loss) (a.k.a. SimCLR loss) ëª¨ë“  pairì— ëŒ€í•´ ê³„ì‚°ëœë‹¤! ì¦‰, ì•„ë˜ì™€ ê°™ë‹¤.

  <img width="250" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 21 14" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/26c4b3fe-4488-4eeb-b45e-8197526a2863">
  
  <img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 21 44" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/2b6fb5b4-9885-4976-8140-f76f317b326a">
  
  <img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 22 01" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/840c7228-1059-4fc2-84c9-f73da430f3b5">

- Data augmentationì„ contrastive learningì— ì ê·¹ì ìœ¼ë¡œ ì´ìš©
  - data augmentation ì¡°í•©ì´ ì„±ëŠ¥ì— ì˜í–¥ì„ í¬ê²Œ ë¯¸ì¹œë‹¤!

    <img width="300" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/a99428ea-4f05-4390-8ac8-a75568cbbd74">

    <img width="350" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 24 53" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/f6868b5d-0d19-4b83-aea6-41a22b8289ec">
    
- Contrastive taskì—ì„œ positive pairsë¥¼ ì™„ë²½í•˜ê²Œ ì°¾ì•„ë‚´ëŠ” ëª¨ë¸ì´ë”ë¼ë„ single transformationì€ ì¢‹ì€ representationì„ ë§Œë“¤ì§€ ëª»í•œë‹¤.
- Composed augmentationsì˜ ê²½ìš°ì—ëŠ” contrastive prediction taskê°€ ë” ì–´ë ¤ì›Œì¡Œì§€ë§Œ representationì˜ í€„ë¦¬í‹°ëŠ” ê·¹ì ìœ¼ë¡œ í–¥ìƒ!

<img width="500" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 25 57" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/5f093daa-90b1-491b-afe7-b0633b0688fe">

<img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 26 09" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/c0b0f454-6e04-4f09-a735-8e8be33c9e02">

- NT-Xent(Normalized Temperature-scaled Cross-Entropy) lossê°€ ë³´ë‹¤ ë‚˜ì€ ì„±ëŠ¥!

<img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 27 47" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/7c59fd0f-49c2-4c9f-8708-dd89ee9c7db1">

- ImageNet accuracy of models trained with few labels

<img width="500" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 28 17" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/ad8dd59b-01c1-4380-a077-f78c108817c0">

- Comparison of transfer learning performance

## Supervised Contrastive Learning (2020)
<img width="300" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 28 55" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/f6d787c0-8cfc-449b-89ee-d3a4018bcefd">

- Self-supervised ë¡œë§Œ ë³´í†µ ì´ìš©ë˜ë˜ contrastive learning ì„ supervised learningë¡œ í™•ì¥!
  - ê¸°ì¡´ ì‚¬ìš©í•˜ë˜ cross-entropyì„±ëŠ¥ì„ ëŠ¥ê°€!

<img width="450" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 30 11" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/011e4ada-9369-4866-b4ca-3c0e39ba200c">

- Self-supervised ì¼ ë•Œ, ê°™ì€ classë¼ë„ ê°™ì€ ìƒ˜í”Œì—ì„œ ë‚˜ì˜¤ì§€ ì•Šì•˜ìœ¼ë©´ negativeë¡œ êµ¬ë¶„ë˜ì—ˆìŒ
  - ê°™ì€ classì„ positive sampleë¡œ ì •ì˜
  - ë³´ë‹¤ ë§ì€ positive sampleê³¼ ë§ì€ negative sampleì„ ì‚¬ìš©ê°€ëŠ¥
 
## Supervised Contrastive Learning (2020) - Cross-entropy vs Self-supervised Contrastive vs Supervised Contrastive

SIMCLRì™€ ìœ ì‚¬í•˜ê²Œ, ì•„ë˜ì˜ 4ê°œì˜ ëª¨ë“ˆ ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤
1. Data Augmentation module
2. Encoder Network
3. Projection Network
4. Contrastive prediction task

<img width="350" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 31 57" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/554d9e45-987c-49f4-8922-06215e05768c">

## Supervised Contrastive Learning (2020) - ëª©ì í•¨ìˆ˜
ğ‘–: ğ‘ğ‘›ğ‘hğ‘œğ‘Ÿ, ğ‘—(ğ‘–) : ğ‘ğ‘œğ‘ ğ‘–ğ‘¡ğ‘–ğ‘£ğ‘’ ğ‘ ğ‘ğ‘šğ‘ğ‘™ğ‘’, {ğ‘˜ âˆˆ ğ´(ğ‘–) \ğ‘—(ğ‘–)} : ğ‘›ğ‘’ğ‘”ğ‘ğ‘¡ğ‘–ğ‘£ğ‘’ ğ‘ ğ‘ğ‘šğ‘ğ‘™ğ‘’ (2(ğ‘ âˆ’ 1) ğ‘–ğ‘›ğ‘‘ğ‘–ğ‘ğ‘’ğ‘ )   
ğ‘§ = ğ‘ƒğ‘Ÿğ‘œğ‘—(ğ¸ğ‘›ğ‘ $\tilde{x}_i$ ) âˆˆ $ğ‘…^{Dp}$ , ğ´(ğ‘–) = ğ¼\{ğ‘–}, ğ‘¡ğ‘’ğ‘›ğ‘ğ‘’ğ‘Ÿğ‘ğ‘¡ğ‘¢ğ‘Ÿğ‘’ ğ‘ğ‘ğ‘Ÿğ‘ğ‘šğ‘’ğ‘¡ğ‘’ğ‘Ÿ âˆ¶ ğœ âˆˆ $ğ‘…^+$  ì¼ë•Œ self-supervised contrastive lossëŠ” ì•„ë˜ì™€ ê°™ì´ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤,

<img width="340" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 35 56" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/1d5b829e-f706-458b-8d47-4ca5c2a1dc82">

ì´ë¥¼ labelì´ ìˆëŠ” supervised ë²„ì „ìœ¼ë¡œ ë°”ê¾¸ë©´, ğ‘ƒ(ğ‘–) = {ğ‘ âˆˆ ğ´(ğ‘–) : $\tilde{y}_p = \tilde{y}_i$ }ë¼ë©´,

<img width="380" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 37 31" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/fa68de73-34fb-4019-8460-329cb0fac5c7">
ì´ ëœë‹¤.   

ì°¸ê³ : ë…¼ë¬¸ì—ì„œëŠ” 2ê°œ ë²„ì „ì˜ lossë¥¼ ì œì•ˆí–ˆë‹¤!

<img width="400" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 38 08" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/b30dad6d-e75c-4561-90d1-0efc72059076">

- SIMCLRì²˜ëŸ¼ 2ê°œ augmentedëœ positive pairì‚¬ìš©. (2Nê°œ batch)
- ì´ë•Œ, ê°™ì€ classë‚´ì˜ ë‹¤ë¥¸ ì´ë¯¸ì§€ë„ positiveë¡œ ì‚¬ìš©í•˜ì—¬ ë§ì€ positiveë¥¼ í™œìš©

## Supervised Contrastive Learning (2020) - ê²°ê³¼ì ìœ¼ë¡œ, SimCLR lossì™€ N-pair lossì˜ ì¼ë°˜í™”!
<img width="295" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 38 51" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/bb7155b6-9db5-4c0d-b0f4-3c5865a0148d">

## Supervised Contrastive Learning (2020) - ê²°ê³¼
<img width="400" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 39 19" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/85b5825a-9d0d-464c-92ec-3415b43240f8">

<img width="400" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-27 á„‹á…©á„’á…® 6 39 38" src="https://github.com/joony0512/Deep_Learning_Class/assets/109457820/d6cb72ec-a213-469b-b4e7-83c07be42fe0">
